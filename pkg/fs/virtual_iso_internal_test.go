package fs

import (
	"os"
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func TestSFO(t *testing.T) {
	baseFS, err := os.OpenRoot(t.TempDir())
	require.NoError(t, err)
	t.Cleanup(func() { _ = baseFS.Close() })

	err = baseFS.WriteFile("param.sfo", []byte{
		0x00, 0x50, 0x53, 0x46, 0x01, 0x01, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00,
		0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x02, 0x0A, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x54, 0x49, 0x54, 0x4C, 0x45, 0x5F, 0x49, 0x44, 0x00, 0x00, 0x00, 0x00,
		0x42, 0x4C, 0x55, 0x53, 0x31, 0x32, 0x33, 0x34, 0x35, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	}, os.ModePerm)
	require.NoError(t, err)

	f, err := baseFS.Open("param.sfo")
	require.NoError(t, err)

	v, err := sfoField(f, "TITLE_ID")
	if assert.NoError(t, err) {
		assert.Equal(t, "BLUS12345", v)
	}
}
